***REMOVED*** 小说创作系统优化路线图

***REMOVED******REMOVED*** 当前状态总结

***REMOVED******REMOVED******REMOVED*** ✅ 已完成的优化
1. **LLM悬念评估**：从0.09-0.24提升到0.90-0.91（优秀）
2. **综合评分**：达到0.98（优秀）
3. **质量监控体系**：完整的质量检查和追踪系统
4. **动态调整机制**：根据质量反馈自动调整

***REMOVED******REMOVED******REMOVED*** ⚠️ 当前问题
1. **重写机制效果不佳**：只有21.1%改善，68.4%无变化，10.5%恶化
2. **字数控制偏差**：平均偏差+17.4%，最大偏差45.9%
3. **质量问题仍存在**：平均每章3.7个问题
4. **重写策略不够精准**：重写后问题数变化不明显

---

***REMOVED******REMOVED*** 优化优先级

***REMOVED******REMOVED******REMOVED*** 🔴 高优先级（影响质量）

***REMOVED******REMOVED******REMOVED******REMOVED*** 1. 重写机制优化
**问题**：
- 重写改善率仅21.1%，68.4%无变化
- 重写后问题数变化不明显（3→3, 4→4）
- 重写策略可能不够精准

**优化方向**：
- [ ] **细化重写触发条件**：
  - 当前：严重问题≥1 或 总问题≥3
  - 建议：根据问题类型和严重程度更精细的触发策略
  - 例如：对话问题≥2个时触发，心理活动问题≥1个时触发
  
- [ ] **优化重写prompt**：
  - 当前：列出所有问题，要求改进
  - 建议：
    - 按问题类型分组，给出具体改进示例
    - 提供"好/坏"对比示例
    - 明确重写后的质量目标（如"对话占比必须达到25%以上"）
    - 使用few-shot示例引导LLM
  
- [ ] **重写后验证机制**：
  - 当前：重写后检查问题数
  - 建议：
    - 如果重写后问题数未减少，尝试不同的重写策略
    - 记录重写失败的原因，用于优化重写prompt
    - 考虑多轮重写（最多2-3轮）

- [ ] **问题优先级排序**：
  - 优先解决严重问题（一致性、对话占比）
  - 次要问题（冗余描述）可以容忍

***REMOVED******REMOVED******REMOVED******REMOVED*** 2. 字数控制优化
**问题**：
- 平均偏差+17.4%（目标2048，实际约2400）
- 最大偏差45.9%（严重超标）
- 动态调整效果不明显

**优化方向**：
- [ ] **更精确的token估算**：
  - 当前：使用固定比例估算
  - 建议：根据历史数据动态调整token/字数比例
  - 考虑不同LLM的token效率差异

- [ ] **分阶段字数控制**：
  - 开头：严格控制（±5%）
  - 发展：允许稍多（±10%）
  - 高潮：允许更多（±15%）
  - 结尾：严格控制（±5%）

- [ ] **字数偏差惩罚机制**：
  - 当偏差>20%时，在prompt中明确要求控制字数
  - 使用更严格的max_tokens限制

- [ ] **字数预测模型**：
  - 根据章节摘要长度预测所需字数
  - 动态调整max_tokens参数

***REMOVED******REMOVED******REMOVED******REMOVED*** 3. 质量问题持续优化
**问题**：
- 平均每章3.7个问题
- 问题类型分布不均（对话、心理活动、描述等）

**优化方向**：
- [ ] **问题类型细分**：
  - 当前：对话、描述、一致性等大类
  - 建议：更细粒度的问题分类
    - 对话：占比过低/过高、缺乏动作、信息转储
    - 描述：环境冗余、心理过度、缺乏推进
    - 一致性：人物、世界观、时间线

- [ ] **预防性检查**：
  - 在生成前检查prompt是否包含可能导致问题的指令
  - 在生成过程中进行中间检查（如果可能）

- [ ] **问题权重调整**：
  - 严重问题（一致性、对话占比）权重更高
  - 次要问题（冗余描述）权重较低

***REMOVED******REMOVED******REMOVED*** 🟡 中优先级（提升体验）

***REMOVED******REMOVED******REMOVED******REMOVED*** 4. 主题适配优化
**问题**：
- 当前策略对所有主题通用
- 不同主题（悬疑、治愈、科幻）可能需要不同策略

**优化方向**：
- [ ] **主题特定策略**：
  - 悬疑：强调悬念、信息控制、氛围营造
  - 治愈：强调情感描写、人物互动、温暖氛围
  - 科幻：强调世界观、技术细节、逻辑严谨
  
- [ ] **主题特定质量指标**：
  - 悬疑：悬念得分权重更高
  - 治愈：对话占比和情感描写权重更高
  - 科幻：世界观一致性权重更高

- [ ] **主题特定prompt模板**：
  - 为不同主题设计专门的prompt模板
  - 根据主题动态调整质量检查标准

***REMOVED******REMOVED******REMOVED******REMOVED*** 5. 质量检查精度提升
**问题**：
- 某些问题可能检测不够准确
- 误报或漏报情况

**优化方向**：
- [ ] **使用LLM进行质量检查**：
  - 当前：规则+简单LLM检查
  - 建议：关键检查项使用LLM（如对话质量、描述质量）
  - 类似悬念评估，使用deepseek_v3_2进行智能检查

- [ ] **多维度验证**：
  - 规则检查 + LLM检查 + 统计分析
  - 综合多个维度的结果

- [ ] **问题描述优化**：
  - 当前：简单描述问题
  - 建议：提供具体位置、具体示例、改进建议

***REMOVED******REMOVED******REMOVED******REMOVED*** 6. 动态调整策略优化
**问题**：
- 调整策略可能不够及时或不够精准

**优化方向**：
- [ ] **更早的调整触发**：
  - 当前：问题出现后才调整
  - 建议：趋势预测，提前调整（如连续3章对话占比低）

- [ ] **调整强度分级**：
  - 轻微问题：提示性调整
  - 中等问题：强制性调整
  - 严重问题：紧急调整+重写

- [ ] **调整效果验证**：
  - 记录调整后的效果
  - 如果调整无效，尝试其他策略

***REMOVED******REMOVED******REMOVED*** 🟢 低优先级（长期优化）

***REMOVED******REMOVED******REMOVED******REMOVED*** 7. 性能优化
**优化方向**：
- [ ] **批量质量检查**：多章并行检查
- [ ] **缓存机制**：重复检查结果缓存
- [ ] **异步处理**：非关键检查异步进行

***REMOVED******REMOVED******REMOVED******REMOVED*** 8. 可观测性增强
**优化方向**：
- [ ] **质量趋势可视化**：图表展示质量变化趋势
- [ ] **问题分布分析**：统计不同类型问题的分布
- [ ] **优化效果追踪**：记录每次优化的效果

***REMOVED******REMOVED******REMOVED******REMOVED*** 9. 用户体验优化
**优化方向**：
- [ ] **实时质量反馈**：创作过程中实时显示质量指标
- [ ] **质量报告优化**：更友好的质量报告格式
- [ ] **自定义质量标准**：允许用户自定义质量检查标准

---

***REMOVED******REMOVED*** 实施建议

***REMOVED******REMOVED******REMOVED*** 第一阶段（立即实施）
1. **重写机制优化**（优先级最高）
   - 细化重写触发条件
   - 优化重写prompt，添加示例
   - 实现重写后验证机制

2. **字数控制优化**
   - 改进token估算
   - 实现分阶段字数控制
   - 添加偏差惩罚机制

***REMOVED******REMOVED******REMOVED*** 第二阶段（近期实施）
3. **质量问题持续优化**
   - 问题类型细分
   - 预防性检查
   - 问题权重调整

4. **主题适配优化**
   - 设计主题特定策略
   - 实现主题特定质量指标

***REMOVED******REMOVED******REMOVED*** 第三阶段（长期规划）
5. **质量检查精度提升**
6. **性能优化**
7. **可观测性增强**

---

***REMOVED******REMOVED*** 成功指标

***REMOVED******REMOVED******REMOVED*** 重写机制
- **目标**：改善率从21.1%提升到60%+
- **指标**：
  - 重写后问题数减少的章节占比
  - 重写后问题数减少的平均值

***REMOVED******REMOVED******REMOVED*** 字数控制
- **目标**：平均偏差从+17.4%降低到±10%以内
- **指标**：
  - 平均字数偏差
  - 最大字数偏差
  - 字数偏差标准差

***REMOVED******REMOVED******REMOVED*** 质量问题
- **目标**：平均每章问题数从3.7降低到2.0以下
- **指标**：
  - 平均每章问题数
  - 严重问题章节占比
  - 问题类型分布

***REMOVED******REMOVED******REMOVED*** 综合质量
- **目标**：综合评分保持在0.95+
- **指标**：
  - 综合评分
  - 各维度得分
  - 质量趋势稳定性

---

***REMOVED******REMOVED*** 注意事项

1. **平衡质量与效率**：优化不应显著增加生成时间
2. **避免过度优化**：某些问题可能是可接受的（如轻微冗余描述）
3. **保持灵活性**：不同主题、不同风格可能需要不同的标准
4. **持续监控**：优化后需要持续监控效果，及时调整策略
