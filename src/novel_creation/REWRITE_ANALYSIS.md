***REMOVED*** é‡å†™æœºåˆ¶é—®é¢˜åˆ†ææŠ¥å‘Š

***REMOVED******REMOVED*** ğŸ”´ ä¸¥é‡é—®é¢˜å‘ç°

***REMOVED******REMOVED******REMOVED*** é—®é¢˜ç°è±¡

1. **æ‰€æœ‰ç« èŠ‚åŸå§‹é—®é¢˜æ•°ä¸º0ï¼Œä½†éƒ½è¢«è§¦å‘é‡å†™**
   - ç¬¬1-20ç« ï¼šåŸå§‹é—®é¢˜æ•°éƒ½æ˜¯0
   - ä½†æ‰€æœ‰ç« èŠ‚éƒ½è¢«æ ‡è®°ä¸º `rewritten: True`
   - é‡å†™ååè€Œå¼•å…¥äº†3-4ä¸ªæ–°é—®é¢˜

2. **é‡å†™åé—®é¢˜ç±»å‹**
   - `plot_inconsistency`ï¼ˆæƒ…èŠ‚ä¸ä¸€è‡´ï¼‰
   - `coherence_issue`ï¼ˆè¿è´¯æ€§é—®é¢˜ï¼‰
   - `style_issue`ï¼ˆé£æ ¼é—®é¢˜ï¼‰

3. **é‡å†™è½®æ¬¡**
   - æ‰€æœ‰ç« èŠ‚éƒ½è¿›è¡Œäº†2-3è½®é‡å†™
   - å¹³å‡é‡å†™è½®æ¬¡ï¼š3.0è½®

***REMOVED******REMOVED******REMOVED*** æ ¹æœ¬åŸå› åˆ†æ

***REMOVED******REMOVED******REMOVED******REMOVED*** 1. é‡å†™è§¦å‘é€»è¾‘é”™è¯¯

**é—®é¢˜**ï¼š`_should_rewrite_chapter` å‡½æ•°å¯èƒ½åœ¨ä»¥ä¸‹æƒ…å†µä¸‹é”™è¯¯è¿”å› `True`ï¼š

```python
***REMOVED*** å½“å‰é€»è¾‘å¯èƒ½çš„é—®é¢˜ï¼š
- å¦‚æœ quality_result ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯ï¼Œå¯èƒ½è¢«è¯¯åˆ¤
- å¦‚æœé—®é¢˜ç±»å‹ç»Ÿè®¡é€»è¾‘æœ‰è¯¯ï¼Œå¯èƒ½è¯¯åˆ¤
- å¦‚æœ should_rewrite å˜é‡åœ¨è´¨é‡æ£€æŸ¥å¤±è´¥æ—¶è¢«é”™è¯¯è®¾ç½®
```

**éœ€è¦æ£€æŸ¥**ï¼š
- `quality_result` çš„ç»“æ„æ˜¯å¦æ­£ç¡®
- `by_severity` å’Œ `by_type` å­—æ®µæ˜¯å¦å­˜åœ¨
- è´¨é‡æ£€æŸ¥å¤±è´¥æ—¶çš„å¤„ç†é€»è¾‘

***REMOVED******REMOVED******REMOVED******REMOVED*** 2. é‡å†™å¼•å…¥æ–°é—®é¢˜

**é—®é¢˜**ï¼šé‡å†™ååè€Œå¼•å…¥äº†æ–°é—®é¢˜ï¼Œè¯´æ˜ï¼š
- é‡å†™ prompt å¯èƒ½ä¸å¤Ÿç²¾å‡†
- é‡å†™è¿‡ç¨‹å¯èƒ½ç ´åäº†åŸæœ‰çš„è´¨é‡
- é‡å†™åçš„è´¨é‡æ£€æŸ¥å¯èƒ½æ›´ä¸¥æ ¼

**å¯èƒ½åŸå› **ï¼š
- é‡å†™æ—¶æ”¹å˜äº†æ ¸å¿ƒæƒ…èŠ‚ï¼Œå¯¼è‡´ `plot_inconsistency`
- é‡å†™æ—¶æ”¹å˜äº†é£æ ¼ï¼Œå¯¼è‡´ `style_issue`
- é‡å†™æ—¶ç ´åäº†è¿è´¯æ€§ï¼Œå¯¼è‡´ `coherence_issue`

***REMOVED******REMOVED*** ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

***REMOVED******REMOVED******REMOVED*** ä¼˜å…ˆçº§1ï¼šä¿®å¤è§¦å‘é€»è¾‘

***REMOVED******REMOVED******REMOVED******REMOVED*** 1.1 æ·»åŠ å®‰å…¨æ£€æŸ¥

```python
def _should_rewrite_chapter(self, quality_result: Dict[str, Any], chapter_number: int) -> bool:
    """åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å†™ç« èŠ‚"""
    
    ***REMOVED*** å®‰å…¨æ£€æŸ¥ï¼šå¦‚æœè´¨é‡æ£€æŸ¥å¤±è´¥æˆ–æ²¡æœ‰ç»“æœï¼Œä¸é‡å†™
    if not quality_result or quality_result.get('error'):
        logger.warning(f"ç¬¬{chapter_number}ç« è´¨é‡æ£€æŸ¥å¤±è´¥ï¼Œä¸è§¦å‘é‡å†™")
        return False
    
    ***REMOVED*** å®‰å…¨æ£€æŸ¥ï¼šå¦‚æœé—®é¢˜æ•°ä¸º0ï¼Œä¸é‡å†™
    total_issues = quality_result.get('total_issues', 0)
    if total_issues == 0:
        logger.debug(f"ç¬¬{chapter_number}ç« æ— è´¨é‡é—®é¢˜ï¼Œä¸è§¦å‘é‡å†™")
        return False
    
    ***REMOVED*** å…¶ä½™é€»è¾‘...
```

***REMOVED******REMOVED******REMOVED******REMOVED*** 1.2 ä¿®å¤é—®é¢˜ç±»å‹ç»Ÿè®¡

```python
***REMOVED*** ç¡®ä¿ by_severity å’Œ by_type å­—æ®µå­˜åœ¨
by_severity = quality_result.get('by_severity', {})
by_type = quality_result.get('by_type', {})

***REMOVED*** å¦‚æœå­—æ®µä¸å­˜åœ¨ï¼Œä» issues ä¸­ç»Ÿè®¡
if not by_severity or not by_type:
    by_severity = {'high': 0, 'medium': 0, 'low': 0}
    by_type = {}
    for issue in issues:
        severity = issue.get('severity', 'low')
        by_severity[severity] = by_severity.get(severity, 0) + 1
        issue_type = issue.get('type', 'unknown')
        by_type[issue_type] = by_type.get(issue_type, 0) + 1
```

***REMOVED******REMOVED******REMOVED*** ä¼˜å…ˆçº§2ï¼šä¼˜åŒ–é‡å†™ç­–ç•¥

***REMOVED******REMOVED******REMOVED******REMOVED*** 2.1 é¿å…ç ´ååŸæœ‰è´¨é‡

```python
***REMOVED*** åœ¨é‡å†™ prompt ä¸­æ˜ç¡®è¦æ±‚ï¼š
- å¦‚æœåŸå§‹å†…å®¹æ²¡æœ‰ä¸¥é‡é—®é¢˜ï¼Œåªè¿›è¡Œå¾®è°ƒï¼Œä¸è¦å¤§å¹…ä¿®æ”¹
- ä¿æŒæ ¸å¿ƒæƒ…èŠ‚ã€äººç‰©æ€§æ ¼ã€ä¸–ç•Œè§‚è®¾å®šä¸å˜
- åªæ”¹è¿›æ£€æµ‹åˆ°çš„å…·ä½“é—®é¢˜ï¼Œä¸è¦å¼•å…¥æ–°é—®é¢˜
```

***REMOVED******REMOVED******REMOVED******REMOVED*** 2.2 æ·»åŠ é‡å†™å‰è´¨é‡æ£€æŸ¥

```python
***REMOVED*** åœ¨é‡å†™å‰æ£€æŸ¥ï¼š
- å¦‚æœåŸå§‹é—®é¢˜æ•° <= 1ï¼Œä¸”éƒ½æ˜¯ä½ä¸¥é‡åº¦é—®é¢˜ï¼Œä¸é‡å†™
- å¦‚æœåŸå§‹é—®é¢˜æ•° == 0ï¼Œç»å¯¹ä¸é‡å†™
- åªå¯¹ç¡®å®æœ‰é—®é¢˜çš„ç« èŠ‚è¿›è¡Œé‡å†™
```

***REMOVED******REMOVED******REMOVED*** ä¼˜å…ˆçº§3ï¼šæ”¹è¿›é‡å†™ Prompt

***REMOVED******REMOVED******REMOVED******REMOVED*** 3.1 æ›´ä¿å®ˆçš„é‡å†™ç­–ç•¥

```python
***REMOVED*** å¯¹äºé—®é¢˜æ•°è¾ƒå°‘çš„ç« èŠ‚ï¼Œä½¿ç”¨æ›´ä¿å®ˆçš„é‡å†™ç­–ç•¥ï¼š
- åªä¿®æ”¹æœ‰é—®é¢˜ specific çš„éƒ¨åˆ†
- ä¿æŒå…¶ä»–éƒ¨åˆ†å®Œå…¨ä¸å˜
- ä¸è¦"ä¼˜åŒ–"æ²¡æœ‰é—®é¢˜çš„å†…å®¹
```

***REMOVED******REMOVED******REMOVED******REMOVED*** 3.2 æ·»åŠ è´¨é‡ä¿æŠ¤æœºåˆ¶

```python
***REMOVED*** é‡å†™åéªŒè¯ï¼š
- å¦‚æœé‡å†™åé—®é¢˜æ•°å¢åŠ ï¼Œå›é€€åˆ°åŸå§‹å†…å®¹
- å¦‚æœé‡å†™åå¼•å…¥äº†æ–°ç±»å‹çš„é—®é¢˜ï¼Œå›é€€
- åªæ¥å—é—®é¢˜æ•°å‡å°‘æˆ–ä¸å˜çš„é‡å†™ç»“æœ
```

***REMOVED******REMOVED*** ğŸ“Š é¢„æœŸæ”¹è¿›æ•ˆæœ

***REMOVED******REMOVED******REMOVED*** ä¿®å¤è§¦å‘é€»è¾‘å

- âœ… é—®é¢˜æ•°ä¸º0çš„ç« èŠ‚ä¸å†è¢«é‡å†™
- âœ… åªæœ‰çœŸæ­£æœ‰é—®é¢˜çš„ç« èŠ‚æ‰ä¼šè¢«é‡å†™
- âœ… å‡å°‘ä¸å¿…è¦çš„é‡å†™ï¼Œæå‡æ•ˆç‡

***REMOVED******REMOVED******REMOVED*** ä¼˜åŒ–é‡å†™ç­–ç•¥å

- âœ… é‡å†™åé—®é¢˜æ•°å‡å°‘ç‡æå‡åˆ°60%+
- âœ… é‡å†™åä¸å†å¼•å…¥æ–°é—®é¢˜
- âœ… é‡å†™è´¨é‡æ˜¾è‘—æå‡

***REMOVED******REMOVED*** ğŸš€ å®æ–½æ­¥éª¤

1. **ç«‹å³ä¿®å¤**ï¼šæ·»åŠ è§¦å‘é€»è¾‘çš„å®‰å…¨æ£€æŸ¥
2. **æµ‹è¯•éªŒè¯**ï¼šè¿è¡Œå°è§„æ¨¡æµ‹è¯•ï¼ŒéªŒè¯ä¿®å¤æ•ˆæœ
3. **ä¼˜åŒ–ç­–ç•¥**ï¼šæ”¹è¿›é‡å†™ prompt å’Œç­–ç•¥
4. **å…¨é¢æµ‹è¯•**ï¼šè¿è¡Œå®Œæ•´æµ‹è¯•ï¼ŒéªŒè¯æ•´ä½“æ•ˆæœ
